/*
* Raphael Line Chart 1.3 - Raphael Line Charts plugin
*
* Copyright (c) 2021 Sagie Maoz (http://sagie.maoz.info)
* Dual-licensed under the GPL (http://www.opensource.org/licenses/gpl-3.0)
* and the MIT (http://www.opensource.org/licenses/mit-license) licenses.
*/

(function(){Raphael.fn.drawGrid=function(e,l,m,a,d,b,c,f){var n;f=["M",Math.round(e)+0.5,Math.round(l)+0.5,"L",Math.round(e+m)+0.5,Math.round(l)+0.5,Math.round(e+m)+0.5,Math.round(l+a)+0.5,Math.round(e)+0.5,Math.round(l+a)+0.5,Math.round(e)+0.5,Math.round(l)+0.5];n=Math.ceil(a/c);for(var k=0;k<c;k++)f=f.concat(["M",Math.round(e)+0.5,Math.round(l+k*n)+0.5,"H",Math.round(e+m)+0.5]);d||(d=1,b=10);m=Math.ceil(m/b);for(k=0;k<b;k+=d)f=f.concat(["M",Math.round(e+k*(m+1.1))+0.5,Math.round(l)+0.5,"V",Math.round(l+
a)+0.5]);return this.path(f.join(","))};Raphael.fn.popup=function(e,l,m,a,d){a=String(a||"top-middle").split("-");a[1]=a[1]||"middle";tokenRegex=/\{([^\}]+)\}/g;objNotationRegex=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g;replacer=function(a,b,d){var c=d;b.replace(objNotationRegex,function(a,b,d,f,g){b=b||f;c&&(b in c&&(c=c[b]),"function"==typeof c&&g&&(c=c()))});return c=(null==c||c==d?a:c)+""};fill=function(a,b){return String(a).replace(tokenRegex,function(a,d){return replacer(a,
d,b)})};r=5;bb=m.getBBox();w=Math.round(bb.width);h=Math.round(bb.height);x=Math.round(bb.x)-r;y=Math.round(bb.y)-r;gap=Math.min(h/2,w/2,10);shapes={top:"M{x},{y}h{w4},{w4},{w4},{w4}a{r},{r},0,0,1,{r},{r}v{h4},{h4},{h4},{h4}a{r},{r},0,0,1,-{r},{r}l-{right},0-{gap},{gap}-{gap}-{gap}-{left},0a{r},{r},0,0,1-{r}-{r}v-{h4}-{h4}-{h4}-{h4}a{r},{r},0,0,1,{r}-{r}z",bottom:"M{x},{y}l{left},0,{gap}-{gap},{gap},{gap},{right},0a{r},{r},0,0,1,{r},{r}v{h4},{h4},{h4},{h4}a{r},{r},0,0,1,-{r},{r}h-{w4}-{w4}-{w4}-{w4}a{r},{r},0,0,1-{r}-{r}v-{h4}-{h4}-{h4}-{h4}a{r},{r},0,0,1,{r}-{r}z",
right:"M{x},{y}h{w4},{w4},{w4},{w4}a{r},{r},0,0,1,{r},{r}v{h4},{h4},{h4},{h4}a{r},{r},0,0,1,-{r},{r}h-{w4}-{w4}-{w4}-{w4}a{r},{r},0,0,1-{r}-{r}l0-{bottom}-{gap}-{gap},{gap}-{gap},0-{top}a{r},{r},0,0,1,{r}-{r}z",left:"M{x},{y}h{w4},{w4},{w4},{w4}a{r},{r},0,0,1,{r},{r}l0,{top},{gap},{gap}-{gap},{gap},0,{bottom}a{r},{r},0,0,1,-{r},{r}h-{w4}-{w4}-{w4}-{w4}a{r},{r},0,0,1-{r}-{r}v-{h4}-{h4}-{h4}-{h4}a{r},{r},0,0,1,{r}-{r}z"};offset={hx0:e-(x+r+w-2*gap),hx1:e-(x+r+w/2-gap),hx2:e-(x+r+gap),vhy:l-(y+r+h+r+
gap),"^hy":l-(y-gap)};mask=[{x:x+r,y:y,w:w,w4:w/4,h4:h/4,right:0,left:w-2*gap,bottom:0,top:h-2*gap,r:r,h:h,gap:gap},{x:x+r,y:y,w:w,w4:w/4,h4:h/4,left:w/2-gap,right:w/2-gap,top:h/2-gap,bottom:h/2-gap,r:r,h:h,gap:gap},{x:x+r,y:y,w:w,w4:w/4,h4:h/4,left:0,right:w-2*gap,top:0,bottom:h-2*gap,r:r,h:h,gap:gap}]["middle"==a[1]?1:2*("top"==a[1]||"left"==a[1])];var b=0,c=0,f=this.path(fill(shapes[a[0]],mask)).insertBefore(m);switch(a[0]){case "top":b=e-(x+r+mask.left+gap);c=l-(y+r+h+r+gap);break;case "bottom":b=
e-(x+r+mask.left+gap);c=l-(y-gap);break;case "left":b=e-(x+r+w+r+gap);c=l-(y+r+mask.top+gap);break;case "right":b=e-(x-gap),c=l-(y+r+mask.top+gap)}f.translate(b,c);if(d)return d=f.attr("path"),f.remove(),{path:d,dx:b,dy:c};m.translate(b,c);return f};Raphael.fn.lineChart=function(e){var l={init:function(a){this.lineChart.settings=m.extend(!0,{},this.lineChart.defaults,a);this.customAttributes.lineChart={};a=this.customAttributes.lineChart;var d=this.lineChart.settings,b=d.width,c=d.height,f=m.getTable(this,
a,d.data,d.data_holder),n=f.labels.length,k=Math.max.apply(Math,f.data),g=this.text(-50,-50,k).attr(d.text.axis_labels).getBBox().width,g={top:d.gutter.top,right:d.gutter.right,bottom:d.gutter.bottom,left:d.gutter.left+g},t=this.set(),u=(b-g.left)/n,p,e,l,q,s;d.y_labels_count&&k>10*d.y_labels_count&&(e=25*d.y_labels_count,k=Math.ceil(k/e)*e);p=k?(c-g.bottom-g.top)/k:0;a.gutter=g;a.labelGutter=d.gutter.left;a.size=n;a.dots=[];a.rects=[];a.info=[];a.path=this.path().attr({stroke:d.colors.master,"stroke-width":4,
"stroke-linejoin":"round"});a.bgp=d.show_area?this.path().attr({stroke:"none",opacity:0.3,fill:d.colors.master}):this.path().attr({stroke:"none",opacity:0,fill:d.colors.master}).hide();a.gridDrawn||!1!==d.no_grid||this.drawGrid(g.left+0.5*u+0.5,g.top+0.5,b-g.left-u,c-g.top-g.bottom,d.x_labels_step,n,d.y_labels_count,k).attr({stroke:"#eaeaea"}).toBack();a.gridDrawn=!0;a.XLabels=[];d.x_labels_step&&m.drawXLabels(this,f.labels);a.YLabels=[];d.y_labels_count&&m.drawYLabels(this,k);a.label=this.set();
a.label.push(this.text(60,12,"24 hits").attr(d.text.popup_line1));a.label.push(this.text(60,27,"22 September 2008").attr(d.text.popup_line2).attr({fill:d.colors.master}));a.label.hide();a.frame=this.popup(100,100,a.label,"right").attr({fill:"#ffffff",stroke:"#666","stroke-width":2,"fill-opacity":0.8}).hide();for(b=0;b<n;b++){var v;s=Math.round(c-g.bottom-p*f.data[b])||0;q=Math.round(g.left+u*(b+0.5));if(!b)e=["M",q,s,"C",q,s],l=["M",g.left+0.5*u,c-g.bottom,"L",q,s,"C",q,s];else if(b<n-1){k=Math.round(c-
g.bottom-p*f.data[b-1]);v=Math.round(g.left+u*(b-0.5));var z=Math.round(c-g.bottom-p*f.data[b+1]),B=Math.round(g.left+u*(b+1.5)),k=m.getAnchors(v,k,q,s,B,z);e=e.concat([k.x1,k.y1,q,s,k.x2,k.y2]);l=l.concat([k.x1,k.y1,q,s,k.x2,k.y2])}d.no_dot||(k=this.circle(q,s,4).attr({fill:"#ffffff",stroke:d.colors.master,"stroke-width":2}),0===s&&k.attr({opacity:0}),a.dots.push(k),t.push(this.rect(g.left+u*b,0,u,c-g.bottom).attr({stroke:"none",fill:"#fff",opacity:0})),v=t[t.length-1],a.rects.push(v),a.info.push({x:q,
y:s,data:f.data[b],label:f.labels[b],line1:f.lines1[b],line2:f.lines2[b]}),m.bindHoverEvent(this,b,k,v,a.frame,a.label))}e=e.concat([q,s,q,s]);l=l.concat([q,s,q,s,"L",q,c-g.bottom,"z"]);a.path.attr({path:e});a.bgp.attr({path:l});a.frame.toFront();a.label[0].toFront();a.label[1].toFront();t.toFront()},setDataIndex:function(a){var d=this.customAttributes.lineChart;return a<d.dataArray.data.length?this.lineChart("setData",{labels:d.dataArray.labels,data:d.dataArray.data[a],lines1:d.dataArray.lines1[a],
lines2:d.dataArray.lines2[a]}):m.error("Data index out of range.")},setDataHolder:function(a){return(a=m.loadTableData(this,a))?this.lineChart("setData",a):m.error("No data holder element supplied.")},setData:function(a){var d=this.lineChart.settings,b=this.customAttributes.lineChart,c=d.height,f=b.gutter,n=(d.width-f.left)/a.labels.length,k=Math.max.apply(Math,a.data),g,t,e;a=m.getTable(this,b,a);if(a.labels.length!=b.size)return m.error("New data source has to be of same size");d.y_labels_count&&
k>10*d.y_labels_count&&(t=25*d.y_labels_count,k=Math.ceil(k/t)*t);g=k?(c-f.bottom-f.top)/k:0;for(var p=0,l=a.labels.length;p<l;p++){var A=b.dots[p];y=Math.round(c-f.bottom-g*a.data[p])||0;x=Math.round(f.left+n*(p+0.5));if(!p)t=["M",x,y,"C",x,y],e=["M",f.left+0.5*n,c-f.bottom,"L",x,y,"C",x,y];else if(p<l-1){var q=Math.round(c-f.bottom-g*a.data[p-1]),s=Math.round(f.left+n*(p-0.5)),v=Math.round(c-f.bottom-g*a.data[p+1]),z=Math.round(f.left+n*(p+1.5)),q=m.getAnchors(s,q,x,y,z,v);t=t.concat([q.x1,q.y1,
x,y,q.x2,q.y2]);e=e.concat([q.x1,q.y1,x,y,q.x2,q.y2])}A.animate({cy:y},d.animation.speed,d.animation.easing);b.info[p]={x:x,y:y,data:a.data[p],label:a.labels[p],line1:a.lines1[p],line2:a.lines2[p]}}t=t.concat([x,y,x,y]);e=e.concat([x,y,x,y,"L",x,c-f.bottom,"z"]);b.path.animate({path:t},d.animation.speed,d.animation.easing);b.bgp.animate({path:e},d.animation.speed,d.animation.easing);d.x_labels_step&&m.drawXLabels(this,a.labels);d.y_labels_count&&m.drawYLabels(this,k)}},m={extend:function(){var a=
arguments[0]||{},d=1,b=arguments.length,c=!1,f,n,k,g;"boolean"===typeof a&&(c=a,a=arguments[1]||{},d=2);"object"!==typeof a&&"function"!==typeof a&&(a={});b===d&&(a=this,--d);for(;d<b;d++)if(null!==(f=arguments[d]))for(n in f)f.hasOwnProperty(n)&&(k=a[n],g=f[n],a!==g&&(c&&g&&(g.constructor==Object||g.constructor==Array)?a[n]=m.extend(c,!k||k.constructor!=Object&&k.constructor!=Array?g.constructor==Array?[]:{}:k,g):void 0!==g&&(a[n]=g)));return a},getAnchors:function(a,d,b,c,f,n){var k=(b-a)/2,g=(f-
b)/2;a=Math.atan((b-a)/Math.abs(c-d));f=Math.atan((f-b)/Math.abs(c-n));var e=dy1=dx2=dy2=0,l;a=d<c?Math.PI-a:a;f=n<c?Math.PI-f:f;l=Math.PI/2-(a+f)%(2*Math.PI)/2;e=k*Math.sin(l+a);dx2=g*Math.sin(l+f);d!=c&&(dy1=k*Math.cos(l+a));c!=n&&(dy2=g*Math.cos(l+f));return{x1:b-e,y1:c+dy1,x2:b+dx2,y2:c+dy2}},getTable:function(a,d,b,c){var f=a.lineChart.settings.data_index;return b?b.data[f].constructor==Array?(d.dataArray=b,a={},a.labels=b.labels,a.data=b.data[f],a.lines1=b.lines1[f],a.lines2=b.lines2[f],a):
b:m.loadTableData(a,c)},loadTableData:function(a,d){var b=a.lineChart.settings,c=d&&d.constructor==String?document.getElementById(d):d,f={labels:[],data:[],lines1:[],lines2:[]},n={},k,g,e;if(c){for(e=0;e<c.childNodes.length;e++,k=null,g="td")"TFOOT"==c.childNodes[e].tagName?(k="labels",g="th"):"TBODY"==c.childNodes[e].tagName&&(c.childNodes[e].className==b.table_classes.data?k="data":c.childNodes[e].className==b.table_classes.line1?k="lines1":c.childNodes[e].className==b.table_classes.line2&&(k="lines2")),
k&&(n[k]=c.childNodes[e].getElementsByTagName(g));if(n.labels&&n.data&&n.lines1&&n.lines2){for(b=0;b<n.labels.length;b++)f.labels.push(n.labels[b].innerHTML);for(b=0;b<n.data.length;b++)f.data.push(n.data[b].innerHTML);for(b=0;b<n.lines1.length;b++)f.lines1.push(n.lines1[b].innerHTML);for(b=0;b<n.lines2.length;b++)f.lines2.push(n.lines2[b].innerHTML)}return f}return!1},bindHoverEvent:function(a,d,b,c,f,e){var k=a.lineChart.settings,g=a.customAttributes.lineChart;c.hover(function(){var c="right",l=
g.info[d],p=l.x,m=l.y;window.clearTimeout(a.leave_timer);p+f.getBBox().width>k.width&&(c="left");c=a.popup(p,m,e,c,1);p=Raphael.animation({path:c.path,transform:["t",c.dx,c.dy]},200*g.is_label_visible);lx=e[0].transform()[0][1]+c.dx;ly=e[0].transform()[0][2]+c.dy;f.show().stop().animate(p);e[0].attr({text:l.line1}).show().stop().animateWith(f,p,{transform:["t",lx,ly]},200*g.is_label_visible);e[1].attr({text:l.line2}).show().stop().animateWith(f,p,{transform:["t",lx,ly]},200*g.is_label_visible);f.toFront();
e[0].toFront();e[1].toFront();this.toFront();b.attr("r",6);g.is_label_visible=!0},function(){b.attr("r",4);a.leave_timer=window.setTimeout(function(){f.hide();e[0].hide();e[1].hide();g.is_label_visible=!1},1)})},drawXLabels:function(a,d){var b=a.lineChart.settings,c=a.customAttributes.lineChart,f=(b.width-c.gutter.left)/c.size,e=b.height-c.gutter.bottom+18,k=b.x_labels_step,b=b.text.axis_labels,g;if(c.XLabels.length)for(g=0;g<c.XLabels.length;g++)c.XLabels[g].remove();c.XLabels=[];for(g=0;g<c.size;g++){var l=
Math.round(c.gutter.left+f*(g+0.5));0===g%k&&(l=a.text(l,e,d[g]).attr(b).toBack(),c.XLabels.push(l))}},drawYLabels:function(a,d){var b=a.lineChart.settings,c=a.customAttributes.lineChart,f=c.labelGutter+20,e=c.gutter.bottom,k=c.gutter.top,g=b.height,l=b.y_labels_count;Math.round(d/l);k=(g-k-e)/l;if(c.YLabels.length)for(var m=0;m<c.YLabels.length;m++)c.YLabels[m].remove();c.YLabels=[];for(m=0;m<=l;m++){var p;p=a.text(f,g-e-m*k,b.y_labels_format(m*(d/l),d,l)).attr(b.text.axis_labels);c.YLabels.push(p)}},
error:function(a){console&&console.error&&console.error("lineChart Error: "+a);return!1}};return l[e]?l[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==typeof e&&e?m.error('Method "'+e+'" not found.'):l.init.apply(this,arguments)};Raphael.fn.lineChart.defaults={data_holder:null,data:null,data_index:0,width:500,height:250,gutter:{top:20,right:0,bottom:50,left:30},show_area:!1,no_dot:!1,no_grid:!1,x_labels_step:!1,y_labels_count:!1,y_labels_format:function(e,l,m){e=l>m?Math.floor(e)+
"":e+"";e=e.replace(/\.(\d{3})\d*/,".$1");return e=e.replace(/(\d{1,3})(?=(?:\d{3})+$)/g,"$1,")},animation:{speed:600,easing:"backOut"},colors:{master:"#01A8F0",line1:"#000000",line2:"#01A8F0"},text:{axis_labels:{font:"10px Helvetica, Arial",fill:"#000000"},popup_line1:{font:"bold 11px Helvetica, Arial",fill:"#000000"},popup_line2:{font:"bold 10px Helvetica, Arial",fill:"#000000"}},table_classes:{data:"data",line1:"line1",line2:"line2"}}})();